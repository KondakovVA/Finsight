<Window x:Class="Finsight.Client.Scenarios.Login.LoginView"
        xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
        xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
        xmlns:mc="http://schemas.openxmlformats.org/markup-compatibility/2006"
        xmlns:d="http://schemas.microsoft.com/expression/blend/2008"
        xmlns:pass="clr-namespace:Finsight.Client.AppFrame.CustomControls"
        xmlns:conv="clr-namespace:Finsight.Client.Converters"
        mc:Ignorable="d"
        d:DesignHeight="550"
        d:DesignWidth="400"
        Width="400"
        Height="550"
        ResizeMode="NoResize"
        WindowStartupLocation="CenterScreen"
        MouseDown="LoginView_OnMouseDown">
    <Window.Resources>
        <ResourceDictionary>
            <ResourceDictionary.MergedDictionaries>
                <ResourceDictionary Source="/AppFrame/Styles/Buttons.xaml"/>
                <ResourceDictionary Source="/AppFrame/Styles/UIColors.xaml"/>
                <ResourceDictionary Source="/AppFrame/Styles/TextBlock.xaml"/>
                <ResourceDictionary Source="/AppFrame/Styles/TextBox.xaml"/>
            </ResourceDictionary.MergedDictionaries>
            <conv:BoolToVisibilityConverter x:Key="BoolToVis"/>
        </ResourceDictionary>
    </Window.Resources>
    <Grid>

        <!-- Фон как у вас -->
        <Border>
            <Border.Background>
                <ImageBrush ImageSource="/Resources/Images/login-background.png" Stretch="None"/>
            </Border.Background>
            <Border Opacity="0.9">
                <Border.BorderBrush>
                    <LinearGradientBrush StartPoint="0,0" EndPoint="1,1">
                        <GradientStop Color="{StaticResource borderColor1}" Offset="0"/>
                        <GradientStop Color="{StaticResource borderColor2}" Offset="0.75"/>
                    </LinearGradientBrush>
                </Border.BorderBrush>
                <Border.Background>
                    <LinearGradientBrush StartPoint="0,1" EndPoint="1,0">
                        <GradientStop Color="{StaticResource backColor1}" Offset="0"/>
                        <GradientStop Color="{StaticResource backColor2}" Offset="0.75"/>
                    </LinearGradientBrush>
                </Border.Background>

                <!-- Хост основного контента: сюда повесим блюр при IsBusy -->
                <Grid x:Name="ContentHost">
                    <Grid.Style>
                        <Style TargetType="Grid">
                            <Style.Triggers>
                                <DataTrigger Binding="{Binding IsBusy}" Value="True">
                                    <Setter Property="Effect">
                                        <Setter.Value>
                                            <BlurEffect Radius="6"/>
                                        </Setter.Value>
                                    </Setter>
                                    <!-- Можно слегка приглушить контент -->
                                    <Setter Property="Opacity" Value="0.7"/>
                                </DataTrigger>
                            </Style.Triggers>
                        </Style>
                    </Grid.Style>

                    <!-- ===== ваш исходный Grid начинается здесь ===== -->
                    <Grid>
                        <Grid.RowDefinitions>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="Auto"/>
                            <RowDefinition Height="*"/>
                            <RowDefinition Height="*"/>
                        </Grid.RowDefinitions>

                        <StackPanel Grid.Row="0">
                            <Image Source="/Resources/Images/main-logo.png" Width="180" Height="180"/>
                            <TextBlock HorizontalAlignment="Center" FontFamily="Century Gothic" FontSize="24"
                                       Margin="0,-30,0,0" Text="FINSIGHT"/>
                        </StackPanel>

                        <StackPanel Grid.Row="1" Orientation="Horizontal" HorizontalAlignment="Center" VerticalAlignment="Bottom">
                            <Image Source="/Resources/Images/login-icon.png" Width="22"/>
                            <TextBox Text="{Binding Login}"
                                     Style="{StaticResource WatermarkTxtBox}"
                                     Tag="Логин"
                                     Width="170" Height="25" Margin="5,0,0,0"
                                     Foreground="{StaticResource titleColor4}"/>
                        </StackPanel>

                        <StackPanel Grid.Row="2" Orientation="Horizontal" HorizontalAlignment="Center">
                            <Image Source="/Resources/Images/password-logo.png" Width="24"/>
                            <pass:ExtPassBox x:Name="PasswordBox" Height="25" Width="175" Padding="5,0,0,0"/>
                        </StackPanel>

                        <TextBlock Grid.Row="3" Width="180" Height="30"
                                   Text="{Binding ErrorText}"
                                   Style="{StaticResource TxtBlock12Size}"
                                   TextAlignment="Center" Foreground="IndianRed" TextWrapping="Wrap"/>

                        <Button Grid.Row="4" x:Name="LoginBtn"
                                HorizontalAlignment="Center" Width="150" Height="35" Margin="0,10,0,0"
                                BorderThickness="0" Content="Войти"
                                Foreground="{StaticResource titleColor1}"
                                FontSize="14" FontFamily="Montserrat" IsDefault="True" FontWeight="Medium"
                                Cursor="Hand" Command="{Binding LoginCommand}"
                                Style="{StaticResource CommonButton}"/>

                        <StackPanel Grid.Row="6" Orientation="Horizontal" VerticalAlignment="Bottom" Margin="0,0,0,20"
                                    HorizontalAlignment="Center">
                            <TextBlock Text="Изменить пароль |" Foreground="WhiteSmoke" Cursor="Hand"
                                       Style="{StaticResource TxtBlock12Size}"/>
                            <TextBlock Text=" Сбросить пароль" Style="{StaticResource TxtBlock12Size}"
                                       Foreground="WhiteSmoke" Cursor="Hand"/>
                        </StackPanel>
                    </Grid>
                    <!-- ===== ваш исходный Grid заканчивается здесь ===== -->
                </Grid>
            </Border>
        </Border>

        <!-- ОВЕРЛЕЙ (поверх всего) -->
        <Grid Panel.ZIndex="999"
              Visibility="{Binding IsBusy, Converter={StaticResource BoolToVis}}">
            <!-- тёмная подложка -->
            <Border Background="#80000000"/>

            <!-- центрированная карточка с индикатором -->
            <Border Width="160" Padding="16" CornerRadius="12" Background="#CC222222"
                    HorizontalAlignment="Center" VerticalAlignment="Center"
                    BorderBrush="#40FFFFFF" BorderThickness="1">
                <StackPanel>
                    <!-- Можно заменить на свой BusyIndicator; здесь — стандартный ProgressBar -->
                    <ProgressBar IsIndeterminate="True" Height="6" Margin="0,4,0,12"/>
                    <TextBlock Text="Загрузка..."
                               HorizontalAlignment="Center"
                               Foreground="White"
                               FontFamily="Segoe UI"
                               FontSize="14"/>
                </StackPanel>
            </Border>
        </Grid>

    </Grid>
</Window>
